<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trackium - Decentralized Cargo Tracking</title>
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="stylesheet" href="./assets/css/styles.css">
    <script type="text/javascript" src="./mds.js"></script>
    <script src="./assets/js/contracts.js"></script>
    <script src="./assets/js/ui-location.js"></script>
    <script src="./assets/js/device-registry.js"></script>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="screen active">
        <div class="loading-container">
            <div class="trackium-logo">
                <div class="logo-icon">üì¶</div>
                <h1>TRACKIUM</h1>
                <p class="tagline">Trust the Movement. Secure the World.</p>
            </div>
            <div class="loading-spinner"></div>
            <p class="loading-text">Connecting to Minima Network...</p>
        </div>
    </div>

    <!-- Main Dashboard -->
<div id="dashboard" class="screen">
  <!-- Header -->
  <header class="app-header">
    <div class="header-left">
      <div class="logo-small">üì¶</div>
      <h2>Trackium</h2>
    </div>
    <div class="header-right">
      <button class="icon-btn" onclick="showScreen('settings')" title="Settings">‚öôÔ∏è</button>
      <button class="icon-btn" onclick="showScreen('help')" title="Help">‚ùì</button>
    </div>
  </header>

  <!-- Stats Cards -->
  <div class="stats-container">
    <div class="stat-card">
      <div class="stat-icon">üîó</div>
      <div class="stat-info">
        <span class="stat-value" id="total-devices">0</span>
        <span class="stat-label">Active Devices</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">üöö</div>
      <div class="stat-info">
        <span class="stat-value" id="active-shipments">0</span>
        <span class="stat-label">Active Shipments</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">üîí</div>
      <div class="stat-info">
        <span class="stat-value" id="locked-devices">0</span>
        <span class="stat-label">Locked</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">‚úÖ</div>
      <div class="stat-info">
        <span class="stat-value" id="verified-proofs">0</span>
        <span class="stat-label">Verified Proofs</span>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions">
    <button class="action-btn primary" onclick="showScreen('add-device')">
      <span class="btn-icon">‚ûï</span>
      <span>Add Device</span>
    </button>
    <button class="action-btn" onclick="showScreen('devices')">
      <span class="btn-icon">üì±</span>
      <span>My Devices</span>
    </button>
    <button class="action-btn" onclick="showScreen('shipments')">
      <span class="btn-icon">üì¶</span>
      <span>Shipments</span>
    </button>
    <button class="action-btn" onclick="showScreen('analytics')">
      <span class="btn-icon">üìä</span>
      <span>Analytics</span>
    </button>
  </div>

  <!-- Recent Activity -->
  <div class="section">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
      <h3 class="section-title">Recent Activity</h3>
      
      <!-- Category Filter -->
      <div style="display: flex; gap: 10px; align-items: center;">
        <label style="font-size: 14px; color: var(--text-secondary);">Filter:</label>
        <select id="activity-category-filter" 
                class="form-input" 
                style="width: 200px; padding: 8px;"
                onchange="filterRecentActivity()">
          <option value="all">All Categories</option>
        </select>
      </div>
    </div>
    
    <div id="recent-activity" class="activity-list"></div>
  </div>
</div>

<script>
// –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ —Ñ–∏–ª—å—Ç—Ä
function loadCategoryFilter() {
  if (!window.deviceManager) return;
  
  window.deviceManager.getAllCategories((categories) => {
    const select = document.getElementById('activity-category-filter');
    if (!select) return;
    
    // –û—á–∏—Å—Ç–∏—Ç—å –∫—Ä–æ–º–µ "All"
    select.innerHTML = '<option value="all">All Categories</option>';
    
    // –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    categories.forEach(category => {
      if (category) {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        select.appendChild(option);
      }
    });
  });
}

// –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
function filterRecentActivity() {
  const selectedCategory = document.getElementById('activity-category-filter').value;
  console.log('Filtering by category:', selectedCategory);
  
  if (!window.db) return;
  
  if (selectedCategory === 'all') {
    // –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ
    window.db.getRecentActivity(10, (events) => {
      window.ui.renderRecentActivity(events);
    });
  } else {
    // –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
    window.db.getDevicesByCategory(selectedCategory, (devices) => {
      const deviceIds = devices.map(d => d.device_id || d.deviceId);
      
      // –ü–æ–ª—É—á–∏—Ç—å —Å–æ–±—ã—Ç–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
      const query = `SELECT * FROM events 
                     WHERE device_id IN ('${deviceIds.join("','")}')
                     ORDER BY timestamp DESC 
                     LIMIT 10`;
      
      window.db.sql(query, (res) => {
        window.ui.renderRecentActivity(res.rows || []);
      });
    });
  }
}

window.loadCategoryFilter = loadCategoryFilter;
window.filterRecentActivity = filterRecentActivity;
</script>

<!-- Add Device Screen - –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø -->
<!-- Add Device Screen - UPDATED VERSION -->
<div id="add-device" class="screen">
  <div class="screen-header">
    <button class="back-btn" onclick="showScreen('dashboard')">‚Üê Back</button>
    <h2>Add Trackium Device</h2>
  </div>
  
  <div class="form-container">
    
    <!-- Location Tracking Setup Block -->
    <div style="margin-bottom: 30px; padding: 20px; background: rgba(255, 140, 0, 0.1); border-left: 4px solid var(--warning-orange); border-radius: 8px;">
      <h3 style="color: var(--warning-orange); margin-bottom: 10px;">üìç Location Tracking Required</h3>
      <p style="margin-bottom: 15px; line-height: 1.6;">
        Trackium requires a location service to track device movement. During testing phase, 
        you need to install a companion service on your device.
      </p>
      <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 15px;">
        ‚ÑπÔ∏è <strong>Note:</strong> In production, Trackium hardware devices will have this service built-in.
      </p>
      
      <button class="primary-btn" onclick="showLocationServiceModal()" style="width: 100%; margin-bottom: 10px;">
        üì• Download Location Service
      </button>
      
      <div style="display: flex; gap: 10px; margin-top: 10px;">
        <button class="secondary-btn" onclick="checkLocationServiceStatus()" style="flex: 1;">
          üîÑ Check Status
        </button>
        <button class="secondary-btn" onclick="testLocationAPI()" style="flex: 1;">
          üß™ Test Connection
        </button>
      </div>
      
      <div id="location-service-status" style="margin-top: 15px; padding: 10px; background: var(--bg-light); border-radius: 6px; display: none;">
        <p style="font-size: 13px; margin: 0;"><strong>Status:</strong> <span id="service-status-text">Unknown</span></p>
        <p style="font-size: 13px; margin: 5px 0 0;"><strong>Last Update:</strong> <span id="service-last-update">Never</span></p>
      </div>
    </div>

    <!-- Device Type -->
    <div class="form-group">
      <label>Device Type / Role</label>
      <select id="device-type" class="form-input" onchange="updateDeviceTypeInfo()">
        <option value="tracker">üì¶ Tracker (NB-IoT)</option>
        <option value="smartlock">üîí Smart Lock + Tracker</option>
        <option value="smartphone">üì± Smartphone (Testing)</option>
      </select>
      <p id="device-type-info" class="device-type-description"></p>
    </div>

    <!-- Transport Type -->
    <div class="form-group">
      <label>Transport Type</label>
      <select id="transport-type" class="form-input">
        <option value="ground">üöö Ground (Truck/Car/Train)</option>
        <option value="sea">üö¢ Sea (Ship/Boat)</option>
        <option value="air">‚úàÔ∏è Air (Plane/Drone)</option>
      </select>
    </div>

    <!-- Category -->
    <div class="form-group">
      <label>Category <span style="color: var(--text-secondary);">(optional)</span></label>
      <input 
        type="text" 
        id="device-category" 
        class="form-input" 
        placeholder="e.g., Electronics, Food, Medical"
        list="category-suggestions">
      <datalist id="category-suggestions">
        <option value="Electronics">
        <option value="Food & Beverages">
        <option value="Medical Supplies">
        <option value="Automotive Parts">
        <option value="Textiles">
        <option value="Industrial Equipment">
        <option value="Pharmaceuticals">
        <option value="Personal Items">
      </datalist>
    </div>

    <!-- Device ID -->
    <div class="form-group">
      <label>Device ID / Serial Number</label>
      <input type="text" id="device-id" class="form-input" placeholder="TRACK-XXXX-XXXX" readonly>
      <button class="secondary-btn" onclick="generateDeviceId()" style="margin-top: 8px;">
        üîÑ Generate ID
      </button>
    </div>

    <!-- Device Name -->
    <div class="form-group">
      <label>Device Name</label>
      <input type="text" id="device-name" class="form-input" placeholder="e.g., Container-EU-01">
    </div>

    <!-- Location -->
    <div class="form-group">
      <label>Initial Location <span style="color: var(--text-secondary);">(optional)</span></label>
      <input type="text" id="device-location" class="form-input" placeholder="e.g., Warehouse A, Kyiv">
    </div>

    <!-- Blockchain Proof -->
    <div class="form-group">
      <label>
        <input type="checkbox" id="enable-blockchain-proof" checked>
        Enable Blockchain Proof-of-Movement
      </label>
    </div>
    
    <!-- Submit Button -->
    <button class="primary-btn full-width" onclick="addDevice()">
      <span>Register Device</span>
    </button>
  </div>
</div>

<!-- Location Service Download Modal -->
<div id="location-service-modal" class="modal">
  <div class="modal-content" style="max-width: 700px;">
    <div class="modal-header">
      <h3>üì• Download Location Service</h3>
      <button class="close-btn" onclick="closeLocationServiceModal()">‚úï</button>
    </div>
    <div class="modal-body">
      
      <!-- Platform Selection -->
      <div style="margin-bottom: 30px;">
        <h4 style="color: var(--primary-blue); margin-bottom: 15px;">Select Your Platform:</h4>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
          <button class="platform-btn" onclick="selectPlatform('macos')" data-platform="macos">
            <span style="font-size: 48px;">üçé</span>
            <p>macOS</p>
          </button>
          <button class="platform-btn" onclick="selectPlatform('windows')" data-platform="windows">
            <span style="font-size: 48px;">ü™ü</span>
            <p>Windows</p>
          </button>
          <button class="platform-btn" onclick="selectPlatform('linux')" data-platform="linux">
            <span style="font-size: 48px;">üêß</span>
            <p>Linux</p>
          </button>
          <button class="platform-btn" onclick="selectPlatform('android')" data-platform="android">
            <span style="font-size: 48px;">ü§ñ</span>
            <p>Android</p>
          </button>
        </div>
      </div>

      <!-- macOS Instructions -->
      <div id="instructions-macos" class="platform-instructions" style="display: none;">
        <h4>üçé macOS Installation</h4>
        <div class="accordion">
          <button class="accordion-btn" onclick="toggleAccordion(this)">
            Step 1: Download Service ‚Üí
          </button>
          <div class="accordion-content">
            <button class="primary-btn" onclick="downloadLocationService('macos')" style="margin: 15px 0;">
              üì• Download trackium-location-service-macos.zip
            </button>
            <p style="font-size: 13px; color: var(--text-secondary);">
              Version 1.0.0 | Size: ~5MB | Requires: Node.js 16+
            </p>
          </div>

          <button class="accordion-btn" onclick="toggleAccordion(this)">
            Step 2: Install Node.js (if needed) ‚Üí
          </button>
          <div class="accordion-content">
            <p>Check if Node.js is installed:</p>
            <pre style="background: var(--bg-dark); padding: 10px; border-radius: 4px; overflow-x: auto;">node --version</pre>
            <p>If not installed, download from: <a href="https://nodejs.org" target="_blank" style="color: var(--primary-blue);">nodejs.org</a></p>
          </div>

          <button class="accordion-btn" onclick="toggleAccordion(this)">
            Step 3: Run Service ‚Üí
          </button>
          <div class="accordion-content">
            <p>1. Extract the ZIP file</p>
            <p>2. Open Terminal in the extracted folder</p>
            <p>3. Run:</p>
            <pre style="background: var(--bg-dark); padding: 10px; border-radius: 4px; overflow-x: auto;">npm install
node trackium-location.js</pre>
            <p style="color: var(--success-green); margin-top: 10px;">‚úÖ Service will start automatically and connect to your MiniDapp</p>
          </div>
        </div>
      </div>

      <!-- Windows Instructions -->
      <div id="instructions-windows" class="platform-instructions" style="display: none;">
        <h4>ü™ü Windows Installation</h4>
        <div class="accordion">
          <button class="accordion-btn" onclick="toggleAccordion(this)">
            Step 1: Download Service ‚Üí
          </button>
          <div class="accordion-content">
            <button class="primary-btn" onclick="downloadLocationService('windows')" style="margin: 15px 0;">
              üì• Download trackium-location-service-windows.zip
            </button>
            <p style="font-size: 13px; color: var(--text-secondary);">
              Version 1.0.0 | Size: ~5MB | Requires: Node.js 16+
            </p>
          </div>

          <button class="accordion-btn" onclick="toggleAccordion(this)">
            Step 2: Install Node.js (if needed) ‚Üí
          </button>
          <div class="accordion-content">
            <p>Check if Node.js is installed (open CMD):</p>
            <pre style="background: var(--bg-dark); padding: 10px; border-radius: 4px; overflow-x: auto;">node --version</pre>
            <p>If not installed, download from: <a href="https://nodejs.org" target="_blank" style="color: var(--primary-blue);">nodejs.org</a></p>
          </div>

          <button class="accordion-btn" onclick="toggleAccordion(this)">
            Step 3: Run Service ‚Üí
          </button>
          <div class="accordion-content">
            <p>1. Extract the ZIP file</p>
            <p>2. Open Command Prompt in the extracted folder</p>
            <p>3. Run:</p>
            <pre style="background: var(--bg-dark); padding: 10px; border-radius: 4px; overflow-x: auto;">npm install
node trackium-location.js</pre>
            <p style="color: var(--success-green); margin-top: 10px;">‚úÖ Service will start automatically</p>
          </div>
        </div>
      </div>

      <!-- Linux Instructions -->
      <div id="instructions-linux" class="platform-instructions" style="display: none;">
        <h4>üêß Linux Installation</h4>
        <div class="accordion">
          <button class="accordion-btn" onclick="toggleAccordion(this)">
            Step 1: Download Service ‚Üí
          </button>
          <div class="accordion-content">
            <button class="primary-btn" onclick="downloadLocationService('linux')" style="margin: 15px 0;">
              üì• Download trackium-location-service-linux.tar.gz
            </button>
          </div>

          <button class="accordion-btn" onclick="toggleAccordion(this)">
            Step 2: Install & Run ‚Üí
          </button>
          <div class="accordion-content">
            <pre style="background: var(--bg-dark); padding: 10px; border-radius: 4px; overflow-x: auto;">tar -xzf trackium-location-service-linux.tar.gz
cd trackium-location-service
npm install
node trackium-location.js</pre>
          </div>
        </div>
      </div>

      <!-- Android Instructions -->
      <div id="instructions-android" class="platform-instructions" style="display: none;">
        <h4>ü§ñ Android Companion App</h4>
        <p style="margin-bottom: 20px;">
          Download and install the Trackium Companion app to enable background location tracking.
        </p>
        <button class="primary-btn" onclick="downloadAndroidApp()" style="width: 100%; margin-bottom: 15px;">
          üì• Download Trackium Companion APK
        </button>
        <div class="accordion">
          <button class="accordion-btn" onclick="toggleAccordion(this)">
            Installation Steps ‚Üí
          </button>
          <div class="accordion-content">
            <ol style="line-height: 1.8;">
              <li>Download the APK file</li>
              <li>Enable "Install from Unknown Sources" in Settings</li>
              <li>Open the APK and install</li>
              <li>Grant Location permissions when prompted</li>
              <li>Enter your Device ID from Trackium MiniDapp</li>
              <li>App will run in background automatically</li>
            </ol>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<style>
.platform-btn {
  background: var(--bg-medium);
  border: 2px solid var(--border-color);
  border-radius: 12px;
  padding: 20px;
  cursor: pointer;
  transition: all 0.3s;
  text-align: center;
}

.platform-btn:hover {
  border-color: var(--primary-blue);
  transform: translateY(-2px);
}

.platform-btn.selected {
  border-color: var(--primary-blue);
  background: rgba(0, 102, 204, 0.1);
}

.platform-btn p {
  margin-top: 10px;
  font-weight: 600;
  color: var(--text-primary);
}

.accordion {
  margin-top: 20px;
}

.accordion-btn {
  width: 100%;
  background: var(--bg-light);
  border: none;
  padding: 15px;
  text-align: left;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
  border-radius: 8px;
  margin-bottom: 5px;
  transition: all 0.3s;
  color: var(--text-primary);
}

.accordion-btn:hover {
  background: var(--bg-medium);
}

.accordion-content {
  display: none;
  padding: 15px;
  background: var(--bg-dark);
  border-radius: 8px;
  margin-bottom: 10px;
  line-height: 1.6;
}

.accordion-content.active {
  display: block;
}

.platform-instructions {
  animation: fadeIn 0.3s;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>

<script>
function showLocationServiceModal() {
  document.getElementById('location-service-modal').classList.add('active');
}

function closeLocationServiceModal() {
  document.getElementById('location-service-modal').classList.remove('active');
}

function selectPlatform(platform) {
  // Highlight selected platform
  document.querySelectorAll('.platform-btn').forEach(btn => {
    btn.classList.remove('selected');
  });
  document.querySelector(`[data-platform="${platform}"]`).classList.add('selected');
  
  // Hide all instructions
  document.querySelectorAll('.platform-instructions').forEach(inst => {
    inst.style.display = 'none';
  });
  
  // Show selected platform instructions
  document.getElementById(`instructions-${platform}`).style.display = 'block';
}

function toggleAccordion(button) {
  const content = button.nextElementSibling;
  const isActive = content.classList.contains('active');
  
  // Close all accordions
  document.querySelectorAll('.accordion-content').forEach(c => {
    c.classList.remove('active');
  });
  
  // Open clicked accordion
  if (!isActive) {
    content.classList.add('active');
  }
}

function downloadLocationService(platform) {
  console.log('Downloading location service for:', platform);
  
  // –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∑–¥–µ—Å—å –±—É–¥–µ—Ç —Ä–µ–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ GitHub releases
  const downloadLinks = {
    macos: '/downloads/trackium-location-service-macos.zip',
    windows: '/downloads/trackium-location-service-windows.zip',
    linux: '/downloads/trackium-location-service-linux.tar.gz'
  };
  
  // Simulate download (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –±—É–¥–µ—Ç fetch/download)
  alert(`Download started for ${platform}!\n\nNote: In production, this will download from GitHub releases.`);
  
  // Show next steps
  if (window.ui) {
    window.ui.showNotification(`Download started for ${platform}`, 'success');
  }
}

function downloadAndroidApp() {
  console.log('Downloading Android companion app');
  alert('Android app download started!\n\nNote: In production, this will download the APK.');
  
  if (window.ui) {
    window.ui.showNotification('Android app download started', 'success');
  }
}

function checkLocationServiceStatus() {
  console.log('Checking location service status...');
  
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ API
  fetch('http://127.0.0.1:9003/api/location/status')
    .then(res => res.json())
    .then(data => {
      const statusDiv = document.getElementById('location-service-status');
      const statusText = document.getElementById('service-status-text');
      const lastUpdate = document.getElementById('service-last-update');
      
      statusDiv.style.display = 'block';
      
      if (data.active) {
        statusText.textContent = '‚úÖ Active';
        statusText.style.color = 'var(--success-green)';
        lastUpdate.textContent = new Date(data.lastUpdate).toLocaleString();
      } else {
        statusText.textContent = '‚ùå Not Running';
        statusText.style.color = 'var(--danger-red)';
        lastUpdate.textContent = 'Never';
      }
    })
    .catch(err => {
      console.error('Failed to check status:', err);
      
      const statusDiv = document.getElementById('location-service-status');
      const statusText = document.getElementById('service-status-text');
      
      statusDiv.style.display = 'block';
      statusText.textContent = '‚ùå Service Not Found';
      statusText.style.color = 'var(--danger-red)';
    });
}

function testLocationAPI() {
  console.log('Testing location API...');
  
  if (window.ui) {
    window.ui.showNotification('Testing location service...', 'info');
  }
  
  fetch('http://127.0.0.1:9003/api/location/test')
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        alert(`‚úÖ Location Service Working!\n\nLat: ${data.latitude}\nLng: ${data.longitude}\nAccuracy: ${data.accuracy}m`);
      } else {
        alert('‚ùå Location service returned an error');
      }
    })
    .catch(err => {
      alert('‚ùå Cannot connect to location service\n\nMake sure the service is running.');
    });
}
</script>

    <!-- Devices List Screen -->
    <div id="devices" class="screen">
        <div class="screen-header">
            <button class="back-btn" onclick="showScreen('dashboard')">‚Üê Back</button>
            <h2>My Devices</h2>
            <button class="icon-btn" onclick="refreshDevices()">üîÑ</button>
        </div>

        <div class="devices-grid" id="devices-list"></div>
    </div>

    <!-- Device Detail Screen -->
    <div id="device-detail" class="screen">
        <div class="screen-header">
            <button class="back-btn" onclick="showScreen('devices')">‚Üê Back</button>
            <h2 id="device-detail-name">Device Details</h2>
            <button class="icon-btn" onclick="deleteDevice(currentDeviceId)">üóëÔ∏è</button>
        </div>

        <div class="device-detail-container">
            <!-- Device Info -->
            <div class="detail-section">
                <h3>Device Information</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">Device ID:</span>
                        <span class="info-value" id="detail-device-id">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Type:</span>
                        <span class="info-value" id="detail-device-type">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Status:</span>
                        <span class="info-value" id="detail-device-status">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Battery:</span>
                        <span class="info-value" id="detail-device-battery">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">GPS Signal:</span>
                        <span class="info-value" id="detail-device-gps">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Last Sync:</span>
                        <span class="info-value" id="detail-device-sync">-</span>
                    </div>
                </div>
            </div>

            <!-- Current Location -->
            <div class="detail-section">
                <h3>Current Location</h3>
                <div id="device-map" class="map-container">
                    <div class="map-placeholder">
                        <span class="location-icon">üìç</span>
                        <p id="device-coordinates">Waiting for GPS...</p>
                    </div>
                </div>
            </div>

            <!-- Smart Lock Controls (if applicable) -->
            <div class="detail-section" id="lock-controls" style="display: none;">
                <h3>Smart Lock Control</h3>
                <div class="lock-status" id="lock-status-display">
                    <div class="lock-icon" id="lock-icon">üîí</div>
                    <p id="lock-status-text">Locked</p>
                </div>
                <div class="lock-actions">
                    <button class="primary-btn" onclick="generateUnlockQR()">Generate Unlock QR</button>
                    <button class="secondary-btn" onclick="toggleLock()">Toggle Lock</button>
                </div>
            </div>

            <!-- Movement History -->
            <div class="detail-section">
                <h3>Movement History</h3>
                <div id="movement-history" class="history-list"></div>
            </div>

            <!-- Blockchain Proofs -->
            <div class="detail-section">
                <h3>Blockchain Proofs</h3>
                <button class="secondary-btn" onclick="submitProofOfMovement()">Submit Proof-of-Movement</button>
                <div id="blockchain-proofs" class="proofs-list"></div>
            </div>
        </div>
    </div>

    <!-- Shipments Screen -->
    <div id="shipments" class="screen">
        <div class="screen-header">
            <button class="back-btn" onclick="showScreen('dashboard')">‚Üê Back</button>
            <h2>Shipments</h2>
            <button class="primary-btn" onclick="showScreen('create-shipment')">+ New Shipment</button>
        </div>

        <div class="shipments-grid" id="shipments-list"></div>
    </div>

    <!-- Create Shipment Screen -->
    <div id="create-shipment" class="screen">
        <div class="screen-header">
            <button class="back-btn" onclick="showScreen('shipments')">‚Üê Back</button>
            <h2>Create Shipment</h2>
        </div>

        <div class="form-container">
            <div class="form-group">
                <label>Shipment ID</label>
                <input type="text" id="shipment-id" class="form-input" placeholder="AUTO-GENERATED">
            </div>

            <div class="form-group">
                <label>Select Device</label>
                <select id="shipment-device" class="form-input"></select>
            </div>

            <div class="form-group">
                <label>Cargo Description</label>
                <textarea id="shipment-cargo" class="form-input" rows="3" placeholder="e.g., Electronics, 50 boxes"></textarea>
            </div>

            <div class="form-group">
                <label>Origin</label>
                <input type="text" id="shipment-origin" class="form-input" placeholder="Starting location">
            </div>

            <div class="form-group">
                <label>Destination</label>
                <input type="text" id="shipment-destination" class="form-input" placeholder="Final destination">
            </div>

            <div class="form-group">
                <label>Expected Delivery</label>
                <input type="datetime-local" id="shipment-delivery" class="form-input">
            </div>

            <button class="primary-btn full-width" onclick="createShipment()">
                <span>Create Shipment</span>
            </button>
        </div>
    </div>

    <!-- Analytics Screen -->
    <div id="analytics" class="screen">
        <div class="screen-header">
            <button class="back-btn" onclick="showScreen('dashboard')">‚Üê Back</button>
            <h2>Analytics</h2>
        </div>

        <div class="analytics-container">
            <div class="chart-section">
                <h3>Device Activity (Last 7 Days)</h3>
                <canvas id="activity-chart"></canvas>
            </div>

            <div class="chart-section">
                <h3>Proof-of-Movement Timeline</h3>
                <div id="proof-timeline"></div>
            </div>
        </div>
    </div>

    <!-- Settings Screen -->
    <div id="settings" class="screen">
        <div class="screen-header">
            <button class="back-btn" onclick="showScreen('dashboard')">‚Üê Back</button>
            <h2>Settings</h2>
        </div>

        <div class="settings-container">
            <div class="setting-group">
                <h3>Blockchain Settings</h3>
                <div class="setting-item">
                    <label>Auto-submit Proof-of-Movement</label>
                    <input type="checkbox" id="auto-proof" class="toggle">
                </div>
                <div class="setting-item">
                    <label>Proof Frequency (minutes)</label>
                    <input type="number" id="proof-frequency" class="form-input" value="60" min="5">
                </div>
            </div>

            <div class="setting-group">
                <h3>Notifications</h3>
                <div class="setting-item">
                    <label>Movement Alerts</label>
                    <input type="checkbox" id="alert-movement" class="toggle" checked>
                </div>
                <div class="setting-item">
                    <label>Lock Status Changes</label>
                    <input type="checkbox" id="alert-lock" class="toggle" checked>
                </div>
            </div>

            <div class="setting-group">
                <h3>Node Information</h3>
                <div class="info-item">
                    <span class="info-label">Node Address:</span>
                    <span class="info-value" id="node-address">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Balance:</span>
                    <span class="info-value" id="node-balance">-</span>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Modal -->
    <div id="qr-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Unlock QR Code</h3>
                <button class="close-btn" onclick="closeQRModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div id="qr-code-container" class="qr-container"></div>
                <p class="qr-instructions">Scan this QR code to unlock the device</p>
                <p class="qr-validity">Valid for: <span id="qr-validity">5 minutes</span></p>
            </div>
        </div>
    </div>

    

    <!-- Scripts -->
    <script src="./assets/js/database.js"></script>
    <script src="./assets/js/blockchain.js"></script>
    <script src="./assets/js/device-manager.js"></script>
    <script src="./assets/js/location-tracker.js"></script>
    <script src="./assets/js/qr-generator.js"></script>
    <script src="./assets/js/ui.js"></script>
    <script src="./assets/js/app.js"></script>

    <!-- GPS Help Modal - –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–º </body> -->


<!-- GPS Help Modal -->
<div id="gps-help-modal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>üìç GPS Setup Guide</h3>
      <button class="close-btn" onclick="closeGPSHelpModal()">‚úï</button>
    </div>
    <div class="modal-body" style="text-align: left;">
      <h4 style="color: var(--primary-blue); margin: 20px 0 10px;">üåç For Web Browsers:</h4>
      <ol style="line-height: 1.8;">
        <li>Click the <strong>üîí lock icon</strong> in address bar</li>
        <li>Find <strong>"Location"</strong> permission</li>
        <li>Set to <strong>"Allow"</strong></li>
        <li>Refresh the page</li>
      </ol>

      <h4 style="color: var(--primary-blue); margin: 20px 0 10px;">üì± For Android Devices:</h4>
      <ol style="line-height: 1.8;">
        <li><strong>Enable GPS:</strong>
          <ul style="margin-left: 20px; margin-top: 5px;">
            <li>Settings ‚Üí Location ‚Üí Turn ON</li>
            <li>Set to <strong>"High Accuracy"</strong> mode</li>
          </ul>
        </li>
        <li><strong>Browser Permissions:</strong>
          <ul style="margin-left: 20px; margin-top: 5px;">
            <li>Settings ‚Üí Apps ‚Üí [Browser] ‚Üí Permissions</li>
            <li>Location ‚Üí <strong>"Allow all the time"</strong></li>
          </ul>
        </li>
      </ol>

      <h4 style="color: var(--primary-blue); margin: 20px 0 10px;">üçé For iOS Devices:</h4>
      <ol style="line-height: 1.8;">
        <li>Settings ‚Üí Privacy ‚Üí Location Services ‚Üí ON</li>
        <li>Find your browser (Safari/Chrome)</li>
        <li>Set to <strong>"While Using the App"</strong></li>
        <li>Enable <strong>"Precise Location"</strong></li>
      </ol>

      <div style="margin-top: 20px; padding: 15px; background: rgba(0, 168, 107, 0.1); border-left: 3px solid var(--success-green); border-radius: 4px;">
        <strong>‚úÖ Test Your GPS:</strong>
        <p style="margin-top: 5px;">
          After enabling permissions, try adding a device again. 
          It may take 10-30 seconds to acquire GPS signal.
        </p>
      </div>
    </div>
  </div>
</div>

<script>
function showGPSHelpModal() {
  document.getElementById('gps-help-modal').classList.add('active');
}

function closeGPSHelpModal() {
  document.getElementById('gps-help-modal').classList.remove('active');
}

// –ó–∞–º–µ–Ω–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –≤ index.html
function showLocationHelpModal() {
  showGPSHelpModal();
}
</script>


</body>
</html>
